use Test_WME

CREATE TABLE #Input (Nr NVARCHAR(MAX));

BULK INSERT #Input
FROM 'C:\Source\AdventOfCode\2019\input6.txt'
WITH (ROWTERMINATOR = '0x0A');


CREATE TABLE ##Orbits (ObjectLeft VARCHAR(5), ObjectRight VARCHAR(5))

INSERT ##Orbits (ObjectLeft, ObjectRight)
SELECT SUBSTRING(Nr, 1, LEN(Nr) - CHARINDEX(')', Nr)),
       SUBSTRING(Nr, LEN(Nr) - CHARINDEX(')', Nr) + 2, LEN(Nr))
FROM #Input


;WITH cte_steps AS (
    SELECT ObjectLeft
    ,      ObjectRight
    ,      1 AS Steps
    ,      CAST(ObjectLeft + '|' + ObjectRight AS VARCHAR(MAX)) As Path
    FROM ##Orbits
    WHERE ObjectLeft = 'COM'
UNION ALL
    SELECT O.ObjectLeft
    ,      O.ObjectRight
    ,      Steps + 1
    ,      CAST(Path + '|' + O.ObjectRight AS VARCHAR(MAX))
    FROM cte_steps cS
    INNER JOIN ##Orbits O ON cS.ObjectRight = O.ObjectLeft
)
--SELECT SUM(Steps)
SELECT *
FROM cte_steps 
WHERE RIGHT(Path, 3) IN ('YOU', 'SAN')
OPTION (MAXRECURSION 20000)

--387356 is correct for part 1


DROP TABLE #Input 
DROP TABLE ##Orbits

/*
X1T	YOU	314	
186	SAN	322	

Part of the path which is the same
COM|7FQ|J6D|49T|MZL|WWP|2YP|JKC|58V|RXM|ZN4|R45|KWM|7LB|763|GZS|33X|2BP|K54|JYR|F87|ZWF|R8F|FQF|MJW|YVK|K3L|7NX|T91|48Z|LLY|4WH|WMJ|7YL|883|RQW|GKV|VJ1|MXR|FGB|1C6|SZ6|365|FVD|V1D|RXS|84W|ZTW|441|JLK|QCQ|
COM|7FQ|J6D|49T|MZL|WWP|2YP|JKC|58V|RXM|ZN4|R45|KWM|7LB|763|GZS|33X|2BP|K54|JYR|F87|ZWF|R8F|FQF|MJW|YVK|K3L|7NX|T91|48Z|LLY|4WH|WMJ|7YL|883|RQW|GKV|VJ1|MXR|FGB|1C6|SZ6|365|FVD|V1D|RXS|84W|ZTW|441|JLK|QCQ|

-- 204 chars == 51 steps

Part of the path where they diverge
DGR|1CT|1CG|NSB|SV4|PV2|2X8|3WK|PRQ|CCT|KK8|VMF|XLN|9WW|YG6|HXW|KHV|V1W|KZN|RGX|1VL|RZY|1RC|SSN|15C|6NH|6Q1|H7K|P37|8RV|VHP|S15|8FP|Q3S|Q25|3KC|ZF1|DFL|Z71|K4W|W1C|179|JC5|SK7|QCC|HDV|3TK|TFK|L2L|DX6|WNL|G6B|1SJ|GYF|1FH|PCQ|M9Y|XNF|3TS|SMD|T9H|KL9|4LL|PY1|MG2|PXL|BGV|MZ8|HMD|9K8|WZX|FB4|7KN|VS9|YGR|BJH|FK8|9MP|Y77|F5X|VNJ|5WM|XG2|RQ2|13R|9LN|4GL|L96|Q95|XRX|6ZJ|HB5|S1M|WT9|CVL|MYV|LPH|7JP|7NH|J2W|8JJ|4WN|T7Q|4B9|BV1|HTK|SB4|D57|L7H|GH7|NF1|3M5|PD4|5YX|9PR|J8C|6GY|ZTL|P34|9K7|513|3YP|P44|YTP|F34|YML|R1J|Z5F|BP2|J3G|K1T|1J4|ZYW|H9V|S4Y|C2M|Q89|RLW|BKM|JYD|MYJ|88N|WW2|CXP|7YC|RCP|GCJ|RZC|CJV|BYK|RKQ|3ZP|XLW|CPW|ZHM|SLK|88T|29N|DKM|X61|YGW|HKK|H8W|VPY|FSX|1PJ|ZVH|BDT|TXC|VB9|NJT|HGH|3B9|X1Z|852|3BL|2RK|42X|XL6|WNW|DR4|FRF|724|YSZ|VXN|BG5|RSR|5PM|X6F|MGC|WJH|YZY|KM4|828|CJY|G2X|6MB|L7K|ZBR|34T|JZR|3NY|9JW|L71|CPG|1R1|GNG|NB5|QFH|SKC|MBX|9TH|Q7N|Z83|FMW|YQP|K6F|XQD|SM3|BLQ|STL|HH1|6FY|266|5T8|H58|K8B|V3L|R2L|956|MZY|NVK|8T8|R26|PVX|XDZ|JDN|LQQ|PY3|DG4|62W|FDV|ZLW|B6K|1N1|DKL|YVB|6QN|81D|1MR|4NP|158|BFJ|XBR|DZT|37X|JVW|JGG|M5X|PZ1|WLT|Q7S|X1T|YOU
DGR|H33|2D3|89D|S55|PQC|BT8|RT1|6XV|Z4B|GZ9|JKN|JX6|QKW|FRW|38H|CYB|V4N|JSX|QK9|7KF|QB4|MB3|F1B|8K5|TZJ|8DX|1DN|L8Y|ZZM|Y2Q|MPM|F71|FJN|SP2|HP7|CHC|BKX|K65|D7G|Z4K|H55|Z93|HP6|325|RW9|RC1|SCB|3FF|ZP8|JRS|1SR|J71|GH2|LRJ|45L|TJM|T71|6CT|CLH|FQ6|TQ2|717|YQ9|F65|QJG|KSX|L2T|LTW|HR8|R5B|RR9|7J9|B1R|BPG|41F|PYL|DGS|GF7|X8R|FZ7|BCB|6YP|LPL|X69|GZ4|3WB|QKL|YS8|DZS|DS4|BLD|VPT|929|7QG|CGC|3VB|JG8|PXC|15S|WZ9|VVT|LGV|ZCY|XT9|VJQ|VL3|73G|B5F|GD4|HJT|Q55|1NT|CTD|97C|WZD|JWF|XGM|KXF|M45|SBN|519|H93|9ZH|DKJ|LGK|LVR|CXQ|9S4|JYK|QRK|5BT|XV7|9CY|RFX|LL2|RCT|T69|H1D|VBT|9G4|55S|5CV|G1L|447|VV7|JZT|CD9|H3H|ZHW|BL1|3JQ|GF2|SPF|GDH|3SS|CYT|JZ3|GGJ|554|VR5|VLW|PJ9|ZDV|614|Q43|HHX|KYD|SZZ|2R7|C2J|7HY|62C|GZL|RD8|BXB|ZGW|D66|9C5|WHN|954|HK5|LGX|KHT|NQZ|P9P|68Z|F7M|BNJ|HKN|4DM|K1R|6XP|D5X|J5G|PHM|3XB|9RT|B87|J9X|XHF|1ZK|9XR|GGY|MNW|HZV|CNG|DMD|VJ6|VSS|W7M|88L|F5W|RMB|WK3|VC2|GC8|1PC|D8R|MND|SM1|DG9|PTJ|TSZ|94F|9ST|9Y9|W8V|NBP|H4Z|8FK|TWM|BS9|R51|V22|BM6|BHY|P13|5DS|YVH|NN1|5PJ|7R8|WYT|WPJ|TQR|N1X|XWC|JS3|QD4|6YZ|N3Y|23D|K85|QPV|V2Q|KL2|2K8|2R5|RV7|TH7|CC1|ZJH|RQ5|9QP|BD6|5Y1|15N|P53|XWH|186|SAN
*/


SELECT (314 - 51) + (322 - 51) 
- 2 --Don't count orbits from Santa or me

--534 is too high
--532 is correct for part 2